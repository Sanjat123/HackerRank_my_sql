SELECT
      c.contest_id,
      c.hacker_id,
      c.name,
      SUM(s2.total_submissions) AS total_submissions,
      SUM(s2.total_accepted_submissions) AS total_accepted_submissions,
      SUM(s2.total_views) AS total_views,
      SUM(s2.total_unique_views) AS total_unique_views
FROM
    CONTESTS c
    JOIN COLLEGES co
        ON c.contest_id = co.contest_id
    JOIN CHALLENGES ch
        ON co.college_id = ch.college_id
    LEFT JOIN (
        SELECT
            s1.challenge_id,
            s1.total_submissions,
            s1.total_accepted_submissions,
            SUM(vs.total_views) AS total_views,
            SUM(vs.total_unique_views) AS total_unique_views
        FROM
            (
                SELECT
                    ch.challenge_id,
                    SUM(ss.total_submissions) AS total_submissions,
                    SUM(ss.total_accepted_submissions) AS total_accepted_submissions
                FROM
                    CHALLENGES ch
                    LEFT JOIN SUBMISSION_STATS ss
                        ON ch.challenge_id = ss.challenge_id
                GROUP BY
                    ch.challenge_id
            ) s1
            LEFT JOIN VIEW_STATS vs
                ON s1.challenge_id = vs.challenge_id
        GROUP BY
            s1.challenge_id, s1.total_submissions, s1.total_accepted_submissions
    ) s2
        ON ch.challenge_id = s2.challenge_id
GROUP BY
      c.contest_id,
      c.hacker_id,
      c.name
ORDER BY
      c.contest_id;
